# md-patch v0.1.1 å‘å¸ƒæ–‡æ¡ˆ

**å‘å¸ƒæ—¥æœŸ**: 2026-02-20  
**å‘å¸ƒå¹³å°**: X (Twitter) / é•¿æ–‡

---

ğŸš€ **md-patch 0.1.1 å‘å¸ƒ â€”â€” ä¸º AI Agent æ‰“é€ çš„å£°æ˜å¼ Markdown ä¿®è¡¥å·¥å…·**

è¿‡å»ä¸€ä¸ªæœˆï¼Œæˆ‘åœ¨è§£å†³ä¸€ä¸ªå›°æ‰°å·²ä¹…çš„é—®é¢˜ï¼šAI Agent ç¼–è¾‘æ–‡æ¡£æ—¶ï¼Œè¡Œå·å¯»å€å¤ªè„†å¼±äº†ã€‚

ä»Šå¤©å‘å¸ƒ `mdp` (md-patch)ï¼Œä¸€ä¸ªå£°æ˜å¼ã€å¹‚ç­‰çš„ Markdown å—ä¿®è¡¥å·¥å…·ã€‚

ğŸ“¦ GitHub: https://github.com/IndenScale/md-patch

---

## å®‰è£…

```bash
# ä¸€é”®å®‰è£… (Linux/macOS)
curl -fsSL https://raw.githubusercontent.com/IndenScale/md-patch/main/install.sh | sh

# æˆ–ä» crates.io
cargo install md-patch
```

---

## åŠ¨æœºï¼šä¸ºä»€ä¹ˆè¡Œå·å¯»å€å¯¹ AI æ˜¯ç¾éš¾

ä¼ ç»Ÿæ–‡æœ¬ç¼–è¾‘å·¥å…·åŸºäºè¡Œå·ï¼š

```bash
# âŒ è„†å¼±ï¼šåœ¨ç¬¬ 42 è¡Œæ’å…¥
sed -i '42i New content' doc.md
```

é—®é¢˜æ˜¯ï¼šæ–‡æ¡£ä¸€æ—¦ä¿®æ”¹ï¼Œè¡Œå·å°±å˜äº†ã€‚AI ç”Ÿæˆè¿™æ ·çš„å‘½ä»¤åï¼Œç”¨æˆ·åœ¨å‰é¢çš„ç« èŠ‚æ·»åŠ äº†ä¸€ä¸ªæ®µè½â€”â€”ç¬¬ 42 è¡Œå°±å˜æˆäº†å®Œå…¨ä¸ç›¸å…³çš„å†…å®¹ã€‚

**AI éœ€è¦è¯­ä¹‰å¯»å€ï¼Œè€Œä¸æ˜¯ä½ç½®å¯»å€ã€‚**

`mdp` ä½¿ç”¨ `file â†’ heading_path â†’ block_index` ä¸‰å±‚å¯»å€æ¨¡å‹ï¼š

```bash
# âœ“ é²æ£’ï¼šåœ¨ "## API" ç« èŠ‚åè¿½åŠ 
mdp patch -f doc.md -H "## API" --op append -c "New endpoint" --force
```

æ— è®ºæ–‡æ¡£å‰é¢æ€ä¹ˆå˜ï¼Œåªè¦ "## API" ç« èŠ‚è¿˜åœ¨ï¼Œæ“ä½œå°±èƒ½æ­£ç¡®æ‰§è¡Œã€‚

---

## è®¾è®¡å“²å­¦ï¼šä¸‰å±‚å®‰å…¨æ¨¡å‹

### 1. å®šä½å±‚ï¼šFingerprint éªŒè¯

`--fingerprint` æ˜¯å®šä½æ¡ä»¶ï¼Œä¸æ˜¯æƒé™ã€‚å¦‚æœå†…å®¹ä¸åŒ¹é…ï¼Œå³ä½¿ `--force` ä¹Ÿæ— æ³•ç»•è¿‡â€”â€”è¿™æ˜¯ä¸ºäº†é˜²æ­¢"ä»¥ä¸ºè‡ªå·±åœ¨æ”¹ Aï¼Œå®é™…æ”¹äº† B"çš„ç¾éš¾ã€‚

```bash
# åªæœ‰å½“å‰å†…å®¹åŒ¹é… "v1.*" æ—¶æ‰æ›¿æ¢
mdp patch -f doc.md -H "## Version" --op replace \
  -c "v2.0.0" \
  --fingerprint "v1\.\d+\.\d+" \
  --force
```

### 2. æƒé™å±‚ï¼šForce æˆæƒ

ç ´åæ€§æ“ä½œï¼ˆreplace/deleteï¼‰éœ€è¦æ˜¾å¼æˆæƒï¼š
- æä¾› fingerprintï¼ˆè¡¨æ˜ä½ çŸ¥é“è‡ªå·±åœ¨æ”¹ä»€ä¹ˆï¼‰
- æˆ–æä¾› `--force`ï¼ˆæ˜ç¡®æ¥å—é£é™©ï¼‰

### 3. ä¿æŠ¤æœºåˆ¶ï¼šåŸå­å†™å…¥ + è‡ªåŠ¨å¤‡ä»½

```text
è¯»å–åŸå§‹ â†’ åˆ›å»º .bak å¤‡ä»½ â†’ å†™å…¥ä¸´æ—¶æ–‡ä»¶ â†’ åŸå­é‡å‘½å
```

ä»»ä½•ä¸€æ­¥å¤±è´¥ï¼ŒåŸå§‹æ–‡ä»¶éƒ½å®Œå¥½æ— æŸã€‚

---

## å¹‚ç­‰æ€§ï¼šè‡ªåŠ¨åŒ–åœºæ™¯çš„å…³é”®

åœ¨ CI/CD æˆ– Agent å·¥ä½œæµä¸­ï¼ŒåŒæ ·çš„æ“ä½œå¯èƒ½è¢«æ‰§è¡Œå¤šæ¬¡ã€‚

`mdp` çš„ append æ“ä½œä¼šæ£€æµ‹å†…å®¹æ˜¯å¦å·²å­˜åœ¨ï¼š

```bash
# ç¬¬ä¸€æ¬¡æ‰§è¡Œ
mdp patch -f doc.md -H "## Features" --op append -c "- X" --force
# â†’ å†…å®¹è¢«è¿½åŠ 

# ç¬¬äºŒæ¬¡æ‰§è¡Œï¼ˆç›¸åŒå‘½ä»¤ï¼‰
mdp patch -f doc.md -H "## Features" --op append -c "- X" --force  
# â†’ æ£€æµ‹åˆ°å·²å­˜åœ¨ï¼Œæ— æ“ä½œï¼ˆno-opï¼‰ï¼Œexit code ä»ä¸º 0
```

JSON è¾“å‡ºä¸­çš„ `is_noop` å­—æ®µè®©ç¨‹åºå¯ä»¥åŒºåˆ†"æˆåŠŸåº”ç”¨"å’Œ"å·²ç»æ˜¯æœ€æ–°çŠ¶æ€"ï¼š

```json
{
  "success": true,
  "applied": true,
  "is_noop": true,
  "changes": [{"status": "noop"}]
}
```

---

## Terraform å¼å·¥ä½œæµï¼šplan â†’ apply

æ‰¹é‡æ“ä½œä½¿ç”¨ YAML é…ç½®ï¼š

```yaml
# update-docs.yaml
operations:
  - file: docs/api.md
    heading: ["# API", "## Authentication"]
    index: 0
    operation: append
    content: "\n### OAuth2\nNew auth method..."

  - file: docs/CHANGELOG.md
    heading: ["# Changelog", "## Unreleased"]
    index: 0
    operation: replace
    content: "## Unreleased\n\n- Added OAuth2 support"
    fingerprint: "## Unreleased"
```

å·¥ä½œæµï¼š

```bash
# 1. é¢„è§ˆå˜æ›´ï¼ˆdry-runï¼‰
mdp plan update-docs.yaml

# 2. ç¡®è®¤ååº”ç”¨
mdp apply update-docs.yaml --force
```

---

## ä¸º Agent è®¾è®¡çš„ JSON æ¥å£

Agent å¯ä»¥ç¨‹åºåŒ–åœ°å¤„ç†é”™è¯¯ï¼š

```bash
mdp patch ... --format json
```

é”™è¯¯è¾“å‡ºåŒ…å«ç»“æ„åŒ–ä¿¡æ¯ï¼š

```json
{
  "success": false,
  "error": {
    "code": "fingerprint_mismatch",
    "message": "Block content doesn't match pattern...",
    "context": {"file": "doc.md", "heading": "## API", "index": 0},
    "suggestion": "Update fingerprint or verify block index"
  }
}
```

---

## ä½¿ç”¨å¿ƒå¾—ï¼šå®ƒæ”¹å˜äº†æˆ‘çš„å·¥ä½œæµ

### åœºæ™¯ 1ï¼šç»´æŠ¤å¤šè¯­è¨€æ–‡æ¡£

æˆ‘çš„é¡¹ç›®æœ‰ä¸­è‹±åŒè¯­ READMEã€‚æ›´æ–°è‹±æ–‡åï¼Œç”¨ `mdp` åŒæ­¥ä¸­æ–‡ç‰ˆæœ¬ï¼š

```bash
# åœ¨ ## Installation åè¿½åŠ æ–°å†…å®¹
mdp patch -f readme_zh.md -H "## å®‰è£…" --op append -c "..."
```

### åœºæ™¯ 2ï¼šAI Agent æ–‡æ¡£ç¼–è¾‘

åœ¨ Agent å·¥ä½œæµä¸­ï¼ŒAgent ç°åœ¨å¯ä»¥ï¼š

1. `mdp plan` é¢„è§ˆè¦åšçš„ä¿®æ”¹
2. å‘ç”¨æˆ·å±•ç¤º diff
3. ç”¨æˆ·ç¡®è®¤å `mdp apply --force`

ä¸å†æ‹…å¿ƒ"åœ¨ç¬¬ X è¡Œæ’å…¥"å¯¼è‡´çš„é”™ä½ç¾éš¾ã€‚

### åœºæ™¯ 3ï¼šé¡¹ç›®è„šæ‰‹æ¶

åˆå§‹åŒ–æ–°é¡¹ç›®æ—¶ï¼Œæ‰¹é‡æ›´æ–°æ¨¡æ¿æ–‡ä»¶ï¼š

```yaml
operations:
  - file: README.md
    heading: ["# Project Name"]
    operation: replace
    content: "# {{project_name}}"
    fingerprint: "# Project Name"
  - file: LICENSE
    heading: []
    index: 0
    operation: replace
    content: "Copyright {{year}} {{author}}"
```

---

## æŠ€æœ¯ç»†èŠ‚

- **çº¯ Rust å®ç°**ï¼Œå•äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ— è¿è¡Œæ—¶ä¾èµ–
- **åç§»é‡ç¼–è¾‘**ï¼Œä¿ç•™åŸå§‹æ ¼å¼ï¼ˆä¸æ˜¯ AST å›å†™ï¼‰
- **LCS ç®—æ³•ç”Ÿæˆ diff**ï¼Œç±»ä¼¼ git diff çš„ä½“éªŒ
- **åµŒå¥— heading è·¯å¾„**ï¼Œè§£å†³åŒåç« èŠ‚æ­§ä¹‰ï¼š`"# Doc A ## Section"`

---

## ä¸‹ä¸€æ­¥

è¿™æ˜¯ 0.1.1 ç‰ˆæœ¬ï¼Œæ ¸å¿ƒåŠŸèƒ½å·²ç¨³å®šã€‚åç»­è®¡åˆ’ï¼š

- æ¡ä»¶æ“ä½œï¼š`when: content matches "..."`
- æ¨¡æ¿å˜é‡æ”¯æŒ
- æ’ä»¶ç³»ç»Ÿ

---

å¦‚æœä½ ä¹Ÿåœ¨ç”¨ AI Agent å¤„ç†æ–‡æ¡£ï¼Œæˆ–è€…åŒå€¦äº† sed/awk çš„è„†å¼±è¡Œå·æ“ä½œï¼Œè¯•è¯• `mdp`ã€‚

ğŸ“¦ https://github.com/IndenScale/md-patch

æ¬¢è¿ issue å’Œ PRã€‚

---

#Markdown #CLI #AI #Agent #Automation #Rust
